# â˜ï¸ Cloudflare Worker Nav

ä¸€ä¸ªæç®€ã€ç¾è§‚ã€å®‰å…¨çš„ä¸ªäººå¯¼èˆªé¡µï¼ŒåŸºäº Cloudflare Workers + D1 æ•°æ®åº“æ„å»ºã€‚

<!-- TODO: æ·»åŠ é¡¹ç›®æˆªå›¾ -->
<!-- ![Demo](./screenshots/demo.png) -->

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âš¡ **é›¶æˆæœ¬éƒ¨ç½²** - Cloudflare Workers å…è´¹é¢åº¦è¶³å¤Ÿä¸ªäººä½¿ç”¨
- ğŸ’¾ **D1 æ•°æ®åº“** - æ— éœ€é¢å¤–é…ç½®æ•°æ®åº“æœåŠ¡å™¨
- ğŸ”’ **å®‰å…¨åŠ å›º** - XSS é˜²æŠ¤ã€é€Ÿç‡é™åˆ¶ã€æ—¶åºå®‰å…¨å¯†ç éªŒè¯
- ğŸ”¥ **çƒ­é—¨æ¨è** - è‡ªåŠ¨ç»Ÿè®¡ç‚¹å‡»é‡ï¼Œæ™ºèƒ½æ¨èå¸¸ç”¨é“¾æ¥
- ğŸ¨ **ç²¾ç¾ UI** - æ¯›ç»ç’ƒæ•ˆæœã€æš—è‰²ä¸»é¢˜ã€å“åº”å¼è®¾è®¡
-  **PWA æ”¯æŒ** - å¯æ·»åŠ åˆ°æ‰‹æœºä¸»å±å¹•

---

## ğŸš€ éƒ¨ç½²æ•™ç¨‹ï¼ˆFork ä¸€é”®éƒ¨ç½²ï¼‰

> æ•´ä¸ªè¿‡ç¨‹çº¦ **10 åˆ†é’Ÿ**ï¼Œæ— éœ€æœ¬åœ°å®‰è£…ä»»ä½•å¼€å‘ç¯å¢ƒ

### ğŸ“‹ ä½ éœ€è¦å‡†å¤‡

- ä¸€ä¸ª [GitHub](https://github.com) è´¦å·
- ä¸€ä¸ª [Cloudflare](https://dash.cloudflare.com) è´¦å·ï¼ˆå…è´¹æ³¨å†Œï¼‰

---

### ç¬¬ä¸€æ­¥ï¼šFork æœ¬ä»“åº“

ç‚¹å‡»å³ä¸Šè§’ **Fork** æŒ‰é’®ï¼Œå°†é¡¹ç›®å¤åˆ¶åˆ°ä½ çš„ GitHub è´¦å·ä¸‹ã€‚

<!-- TODO: Fork æŒ‰é’®æˆªå›¾ -->

---

### ç¬¬äºŒæ­¥ï¼šåˆ›å»º Cloudflare API Token

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com)
2. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ **My Profile**
3. å·¦ä¾§èœå•é€‰æ‹© **API Tokens**
4. ç‚¹å‡» **Create Token**
5. é€‰æ‹© **Edit Cloudflare Workers** æ¨¡æ¿
6. ç‚¹å‡» **Continue to summary** â†’ **Create Token**
7. âš ï¸ **å¤åˆ¶å¹¶ä¿å­˜ Token**ï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼ï¼‰

<!-- TODO: API Token åˆ›å»ºæˆªå›¾ -->

---

### ç¬¬ä¸‰æ­¥ï¼šè·å– Account ID

1. è¿›å…¥ [Cloudflare Dashboard](https://dash.cloudflare.com)
2. ç‚¹å‡»å·¦ä¾§èœå• **Workers & Pages**
3. å³ä¾§ä¼šæ˜¾ç¤º **Account ID**ï¼Œç‚¹å‡»å¤åˆ¶

<!-- TODO: Account ID ä½ç½®æˆªå›¾ -->

---

### ç¬¬å››æ­¥ï¼šåˆ›å»º D1 æ•°æ®åº“

1. åœ¨ Cloudflare Dashboard å·¦ä¾§èœå•ï¼Œå±•å¼€ **Workers & Pages**
2. ç‚¹å‡» **D1 SQL Database**
3. ç‚¹å‡» **Create database**
4. æ•°æ®åº“åç§°å¡«å†™ï¼š`nav-db`
5. ç‚¹å‡» **Create**
6. åˆ›å»ºå®Œæˆåï¼Œå¤åˆ¶é¡µé¢ä¸Šæ˜¾ç¤ºçš„ **Database ID**

<!-- TODO: D1 åˆ›å»ºæˆªå›¾ -->

---

### ç¬¬äº”æ­¥ï¼šé…ç½® GitHub Secrets

å›åˆ°ä½  Fork çš„ GitHub ä»“åº“ï¼š

1. ç‚¹å‡» **Settings** â†’ å·¦ä¾§ **Secrets and variables** â†’ **Actions**
2. ç‚¹å‡» **New repository secret**ï¼Œä¾æ¬¡æ·»åŠ ä»¥ä¸‹ 4 ä¸ª Secretï¼š

| Name | Value | è¯´æ˜ |
|------|-------|------|
| `CLOUDFLARE_API_TOKEN` | ç¬¬äºŒæ­¥è·å–çš„ Token | Cloudflare API ä»¤ç‰Œ |
| `CLOUDFLARE_ACCOUNT_ID` | ç¬¬ä¸‰æ­¥è·å–çš„ ID | Cloudflare è´¦æˆ· ID |
| `CLOUDFLARE_D1_ID` | ç¬¬å››æ­¥è·å–çš„ Database ID | D1 æ•°æ®åº“ ID |
| `PASSWORD` | è‡ªå·±è®¾ç½®ä¸€ä¸ªå¯†ç  | ç®¡ç†å‘˜ç™»å½•å¯†ç  |

å¯é€‰ Secretï¼ˆæ¨èæ·»åŠ ï¼‰ï¼š

| Name | Value | è¯´æ˜ |
|------|-------|------|
| `TOKEN_SALT` | éšæœºå­—ç¬¦ä¸²ï¼ˆå¦‚ `abc123xyz`ï¼‰ | Token åŠ å¯†ç›å€¼ï¼Œå¢å¼ºå®‰å…¨æ€§ |

<!-- TODO: GitHub Secrets é…ç½®æˆªå›¾ -->

---

### ç¬¬å…­æ­¥ï¼šè§¦å‘éƒ¨ç½²

1. è¿›å…¥ä½  Fork çš„ä»“åº“ï¼Œç‚¹å‡» **Actions** æ ‡ç­¾é¡µ
2. å¦‚æœæç¤ºéœ€è¦å¯ç”¨ Actionsï¼Œç‚¹å‡» **I understand my workflows, go ahead and enable them**
3. ç‚¹å‡»å·¦ä¾§ **Deploy Worker & D1**
4. ç‚¹å‡» **Run workflow** â†’ **Run workflow**

ç­‰å¾…çº¦ 1-2 åˆ†é’Ÿï¼Œéƒ¨ç½²å®Œæˆåä¼šæ˜¾ç¤ºç»¿è‰² âœ“

<!-- TODO: Actions è¿è¡Œæˆªå›¾ -->

---

### ç¬¬ä¸ƒæ­¥ï¼šè®¿é—®ä½ çš„å¯¼èˆªé¡µ

éƒ¨ç½²æˆåŠŸåï¼Œè®¿é—®ï¼š

```
https://cf-worker-nav.<ä½ çš„å­åŸŸå>.workers.dev
```

> ğŸ’¡ ä½ çš„å­åŸŸåå¯ä»¥åœ¨ Cloudflare Dashboard â†’ Workers & Pages â†’ Overview é¡µé¢æŸ¥çœ‹

---

## ğŸ”§ è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

1. åœ¨ Cloudflare Dashboard è¿›å…¥ **Workers & Pages**
2. ç‚¹å‡»ä½ çš„ Workerï¼ˆ`cf-worker-nav`ï¼‰
3. ç‚¹å‡» **Settings** â†’ **Triggers** â†’ **Custom Domains**
4. æ·»åŠ ä½ çš„åŸŸåï¼ˆéœ€è¦å…ˆå°†åŸŸå DNS æ‰˜ç®¡åˆ° Cloudflareï¼‰

---

## ğŸ“– ä½¿ç”¨è¯´æ˜

### ç™»å½•ç®¡ç†åå°

1. è®¿é—®ä½ çš„å¯¼èˆªé¡µ
2. æŒ‰é”®ç›˜å¿«æ·é”®ï¼š**Ctrl + /** æˆ– **Cmd + /**
3. è¾“å…¥ä½ è®¾ç½®çš„ `PASSWORD` å¯†ç 
4. ç™»å½•æˆåŠŸåå³å¯æ·»åŠ /ç¼–è¾‘åˆ†ç±»å’Œé“¾æ¥

### åŠŸèƒ½è¯´æ˜

- **æ·»åŠ åˆ†ç±»**ï¼šç‚¹å‡»åº•éƒ¨ "+" æŒ‰é’®
- **æ·»åŠ é“¾æ¥**ï¼šè¿›å…¥åˆ†ç±»åç‚¹å‡» "+" æŒ‰é’®
- **æ‹–æ‹½æ’åº**ï¼šé•¿æŒ‰é“¾æ¥å¡ç‰‡å¯æ‹–åŠ¨æ’åº
- **ç§æœ‰æ¨¡å¼**ï¼šåœ¨è®¾ç½®ä¸­å¼€å¯ï¼Œè®¿é—®éœ€è¦å…ˆç™»å½•

---

## â“ å¸¸è§é—®é¢˜

### Q: éƒ¨ç½²å¤±è´¥æ˜¾ç¤º "D1_ID_PLACEHOLDER"

**A:** ä½ æ²¡æœ‰æ­£ç¡®é…ç½® `CLOUDFLARE_D1_ID` Secretã€‚è¯·æ£€æŸ¥ï¼š
- Secret åç§°å¿…é¡»æ˜¯ `CLOUDFLARE_D1_ID`ï¼ˆå…¨å¤§å†™ï¼‰
- å€¼æ˜¯ D1 æ•°æ®åº“çš„ IDï¼ˆä¸æ˜¯æ•°æ®åº“åç§°ï¼‰

### Q: è®¿é—®æ˜¾ç¤º "Database D1 is not bound"

**A:** D1 æ•°æ®åº“ç»‘å®šå¤±è´¥ã€‚è¯·ç¡®è®¤ï¼š
1. æ•°æ®åº“åç§°æ˜¯ `nav-db`
2. `CLOUDFLARE_D1_ID` é…ç½®æ­£ç¡®
3. é‡æ–°è¿è¡Œä¸€æ¬¡ GitHub Actions

### Q: ç™»å½•æç¤º "Unauthorized"

**A:** å¯†ç é”™è¯¯ã€‚è¯·æ£€æŸ¥ï¼š
- ç¡®è®¤åœ¨ GitHub Secrets ä¸­é…ç½®äº† `PASSWORD`
- å¯†ç åŒºåˆ†å¤§å°å†™
- é‡æ–°éƒ¨ç½²åå¯†ç æ‰ä¼šç”Ÿæ•ˆ

### Q: å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ

**A:** åœ¨ Cloudflare Dashboard åˆ é™¤ D1 æ•°æ®åº“ï¼Œé‡æ–°åˆ›å»ºåŒåæ•°æ®åº“ï¼Œç„¶åè¿è¡Œ GitHub Actionsã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
cf-worker-nav/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js       # Worker ä¸»å…¥å£
â”‚   â”œâ”€â”€ db.js          # æ•°æ®åº“æ“ä½œå±‚
â”‚   â””â”€â”€ ui.js          # å‰ç«¯é¡µé¢æ¸²æŸ“
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ 0001_init.sql  # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ deploy.yml     # è‡ªåŠ¨éƒ¨ç½²é…ç½®
â”œâ”€â”€ wrangler.toml      # Cloudflare é…ç½®
â””â”€â”€ .env.example       # ç¯å¢ƒå˜é‡ç¤ºä¾‹
```

---

## ğŸ”’ å®‰å…¨è¯´æ˜

- å¯†ç ä½¿ç”¨æ—¶åºå®‰å…¨æ¯”å¯¹ï¼Œé˜²æ­¢è®¡æ—¶æ”»å‡»
- 5 æ¬¡å¯†ç é”™è¯¯åé”å®š 15 åˆ†é’Ÿ
- æ‰€æœ‰ç”¨æˆ·è¾“å…¥ç»è¿‡ XSS è¿‡æ»¤
- é“¾æ¥ä»…å…è®¸ http/https åè®®

---

## ğŸ“„ License

MIT

---

Made with â¤ï¸ by Cloudflare Workers
