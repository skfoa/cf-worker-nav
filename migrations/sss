-- Migration number: 0003   2026-01-03
-- Add rate limiting table for brute-force protection

-- 登录尝试记录表（用于防暴力破解）
CREATE TABLE IF NOT EXISTS login_attempts (
    ip TEXT PRIMARY KEY,
    attempts INTEGER NOT NULL DEFAULT 0,
    first_attempt INTEGER NOT NULL,  -- 首次尝试时间戳
    locked_until INTEGER DEFAULT 0   -- 锁定截止时间（0=未锁定）
);

-- 清理索引（定期清理过期记录）
CREATE INDEX IF NOT EXISTS idx_attempts_locked ON login_attempts(locked_until);
